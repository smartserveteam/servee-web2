<!DOCTYPE html>
<html dir="ltr" lang="en-US">
    <head>
        <!-- Metas -->
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="author" content="LionCoders" />
        <!-- Links -->
        <link rel="icon" type="image/png" href="#" />
        <!-- google fonts-->
        <link
            href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800"
            rel="stylesheet"
        />
        <!-- Plugins CSS -->
        <link href="css/plugin.css" rel="stylesheet" />
        <!-- style CSS -->
        <link href="css/style.css" rel="stylesheet" />
        <!--color switcher css-->
        <link
            rel="stylesheet"
            href="css/switcher/skin-aqua.css"
            media="screen"
            id="style-colors"
        />
        <!-- Document Title -->
        <title>Servee.io</title>
    </head>

    <body>
        <!--Page Wrapper starts-->
        <div class="page-wrapper">
            <!--header starts-->
            <header class="transparent scroll-hide">
                <!--Main Menu starts-->
                <div class="site-navbar-wrap v2">
                    <div class="container">
                        <div class="site-navbar">
                            <div class="row align-items-center">
                                <div class="col-md-4 col-6">
                                    <a class="navbar-brand" href="/"
                                        ><img
                                            src="images/logo-black.png"
                                            alt="logo"
                                            class="img-fluid"
                                    /></a>
                                </div>
                            </div>
                        </div>
                        <!--mobile-menu starts -->
                        <div class="site-mobile-menu">
                            <div class="site-mobile-menu-header">
                                <div
                                    class="site-mobile-menu-close  js-menu-toggle"
                                >
                                    <span class="ion-ios-close-empty"></span>
                                </div>
                            </div>
                            <div class="site-mobile-menu-body"></div>
                        </div>
                        <!--mobile-menu ends-->
                    </div>
                </div>
                <!--Main Menu ends-->
            </header>
            <!--Header ends-->
            <!--User Login section starts-->
            <div
                class="user-login-section section-padding bg-fixed"
                style="background-image: url(images/header/hero-5.jpg)"
            >
                <div class="container">
                    <div class="row">
                        <div class="col-md-10 offset-md-1  text-center">
                            <div class="login-wrapper">
                                <ul
                                    class="ui-list nav nav-tabs justify-content-center mar-bot-30"
                                    role="tablist"
                                >
                                    <li class="nav-item">
                                        <a
                                            class="nav-link active"
                                            data-toggle="tab"
                                            href="#login"
                                            role="tab"
                                            aria-selected="true"
                                            >Login</a
                                        >
                                    </li>
                                    <li class="nav-item">
                                        <a
                                            class="nav-link"
                                            data-toggle="tab"
                                            href="#register"
                                            role="tab"
                                            aria-selected="false"
                                            >Register</a
                                        >
                                    </li>
                                </ul>
                                <div class="ui-dash tab-content">
                                    <div
                                        class="tab-pane fade show active"
                                        id="login"
                                        role="tabpanel"
                                    >
                                        <p>
                                            Don't have an account? Click on
                                            Register above to create one
                                        </p>
                                        <form
                                            id="login-form"
                                            action="#"
                                            method="post"
                                        >
                                            <div class="form-group">
                                                <input
                                                    type="text"
                                                    name="email"
                                                    id="email"
                                                    tabindex="1"
                                                    class="form-control"
                                                    placeholder="email"
                                                    value=""
                                                    required
                                                />
                                            </div>
                                            <div class="form-group">
                                                <input
                                                    type="password"
                                                    name="password"
                                                    id="password"
                                                    tabindex="2"
                                                    class="form-control"
                                                    placeholder="Password"
                                                />
                                            </div>
                                            <!-- <div class="row mar-top-20">
                                            <div class="col-md-6 col-12 text-left">
                                                <div class="res-box">
                                                    <input type="checkbox" tabindex="3" class="" name="remember"
                                                        id="remember">
                                                    <label for="remember">Remember Me</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12 text-right">
                                                <div class="res-box sm-left">
                                                    <a id="recoverPassword" href="#" tabindex="5"
                                                        class="forgot-password">Forgot
                                                        Password?</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="error" style="display:none" class="alert alert-danger" role="alert">
                                        </div>
                                        <div class="res-box text-center mar-top-30">
                                            <button type="submit" class="btn v3"><i class="ion-log-in"></i> Log
                                                In</button>
                                        </div>
                                    </form>
                                    <!-- <div class="social-profile-login text-center mar-top-30">
                                        <h5>or Login with</h5>
                                        <ul class="social-btn">
                                            <li class="bg-fb"><a href="#"><i class="ion-social-facebook"></i></a></li>
                                            <li class="bg-tt"><a href="#"><i class="ion-social-twitter"></i></a></li>
                                            <li class="bg-ig"><a href="#"><i class="ion-social-instagram"></i></a></li>
                                        </ul>
                                    </div> -->
                                </div>
                                <div class="tab-pane fade" id="register" role="tabpanel">
                                    <form id="register-form" action="#" method="post">
                                        <div class="form-group">
                                            <input type="text" required="" name="firstName" id="firstName" tabindex="2"
                                                class="form-control" placeholder="First Name" value="">
                                        </div>
                                        <div class="form-group">
                                            <input type="text" required="" name="lastName" id="lastName" tabindex="3"
                                                class="form-control" placeholder="Last Name" value="">
                                        </div>
                                        <div class="form-group">
                                            <input type="email" required="" name="email" id="email" tabindex="1"
                                                class="form-control" placeholder="Email Address" value="">
                                        </div>
                                        <div class="form-group">
                                            <input type="password" required="" name="password" id="password"
                                                tabindex="4" class="form-control" placeholder="Password">
                                        </div>
                                        <div class="form-group">
                                            <input type="password" required="" name="confirm-password"
                                                id="confirm-password" tabindex="5" class="form-control"
                                                placeholder="Confirm Password">
                                        </div>
                                        <div class="res-box text-left">
                                            <input type="checkbox" tabindex="6" class="" name="accept" id="accept">
                                            <label for="accept">I have read and accept the terms &amp;
                                                conditions</label>
                                        </div>
                                        <div id="error" style="display:none" class="alert alert-danger" role="alert">
                                        </div>
                                        <div class="res-box text-center mar-top-30">
                                            <button id="signUp" type="submit" disabled class="btn v3"><i
                                                    class="ion-android-checkmark-circle"></i>Sign Up</button>
                                        </div>
                                    </form>
                                    <!-- <div class="social-profile-login text-center mar-top-30">
                                        <h5>or Sign Up with</h5>
                                        <ul class="social-btn">
                                            <li class="bg-fb"><a href="#"><i class="ion-social-facebook"></i></a></li>
                                            <li class="bg-tt"><a href="#"><i class="ion-social-twitter"></i></a></li>
                                            <li class="bg-ig"><a href="#"><i class="ion-social-instagram"></i></a></li>
                                        </ul>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--User login section ends-->
            <!--Login section ends-->
            <!-- Scroll to top starts-->
            <span class="scrolltotop"><i class="ion-arrow-up-c"></i></span>
            <!-- Scroll to top ends-->
        </div>
        <!--User login section ends-->
        <!-- Code Confirmation Modal -->
        <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Enter code confirmation</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form id="confirmationForm">
                        <div class="modal-body">
                            <p>Please check your email and enter the code that you have received</p>
                            <div class="form-group">
                                <label for="code" class="col-form-label">Code:</label>
                                <input type="text" class="form-control" id="code">
                            </div>
                            <a href="#" id="resendCode">Resend code</a>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Send</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--Login section ends-->
        <!-- Scroll to top starts-->
        <span class="scrolltotop"><i class="ion-arrow-up-c"></i></span>
        <!-- Scroll to top ends-->
    </div>
    <!--Page Wrapper ends-->
    <!--Footer Starts-->
    <div class="footer-wrapper no-pad-tb v2">
        <div class="footer-top-area section-padding">
            <div class="container">
                <div class="row nav-folderized">
                    <div class="col-lg-3 col-md-12">
                        <div class="footer-logo">
                            <a href="index.html"> <img src="images/logo-black.png" alt="logo"></a>
                            <div class="company-desc">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio excepturi nam
                                    totam sequi, ipsam consequatur repudiandae libero illum.
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-12">
                            <div class="footer-content nav">
                                <h2 class="title">Helpful Links</h2>
                                <ul class="list">
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Login</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >My Account</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Add Listing</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Privacy policy</a
                                        >
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-12">
                            <div class="footer-content nav">
                                <h2 class="title">Category</h2>
                                <ul class="list">
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Shop</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Travel</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Sport</a
                                        >
                                    </li>
                                    <li>
                                        <a class="link-hov style2" href="#"
                                            >Restaurant</a
                                        >
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-12">
                            <div class="footer-content nav">
                                <h2 class="title">Contact us</h2>
                                <ul class="list footer-list">
                                    <li>
                                        <div class="contact-info">
                                            <div class="icon">
                                                <i class="ion-ios-location"></i>
                                            </div>
                                            <div class="text">
                                                13th North Ave, Florida, USA
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="contact-info">
                                            <div class="icon">
                                                <i class="ion-email"></i>
                                            </div>
                                            <div class="text">
                                                <a href="#"
                                                    >info@listagram.com</a
                                                >
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="contact-info">
                                            <div class="icon">
                                                <i
                                                    class="ion-ios-telephone"
                                                ></i>
                                            </div>
                                            <div class="text">
                                                +44 078 767 595
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <ul class="social-buttons style2">
                                    <li>
                                        <a href="#"
                                            ><i class="ion-social-facebook"></i
                                        ></a>
                                    </li>
                                    <li>
                                        <a href="#"
                                            ><i class="ion-social-twitter"></i
                                        ></a>
                                    </li>
                                    <li>
                                        <a href="#"
                                            ><i class="ion-social-pinterest"></i
                                        ></a>
                                    </li>
                                    <li>
                                        <a href="#"
                                            ><i class="ion-social-youtube"></i
                                        ></a>
                                    </li>
                                    <li>
                                        <a href="#"
                                            ><i class="ion-social-dribbble"></i
                                        ></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom-area">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="payment-method">
                                <img
                                    src="images/payment/payment-1.png"
                                    alt="..."
                                />
                                <img
                                    src="images/payment/payment-2.png"
                                    alt="..."
                                />
                                <img
                                    src="images/payment/payment-3.png"
                                    alt="..."
                                />
                            </div>
                        </div>
                        <div class="col-md-6 text-right sm-left">
                            <ul class="additional-link">
                                <li><a href="#">Terms &amp; Condition</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                                <li><a href="login.html">Login</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Footer ends-->

    <!--Scripts starts-->
    <!--plugin js-->
    <script src="js/plugin.js"></script>
    <!--google maps-->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_8C7p0Ws2gUu7wo0b6pK9Qu7LuzX2iWY&amp;libraries=places"></script>
    <!--Main js-->
    <script src="js/main.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.487.0.min.js"></script>
    <script src="js/auth.js"></script>
    <!-- This page's script -->
    <script>

        //#region login

        $("#login-form").submit(event => {
            event.preventDefault();
            clearError();

            var authenticationData = {
                Username: $("#email").val(),
                Password: $("#password").val()
            };

            var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
            var poolData = {
                UserPoolId: 'eu-central-1_7iruUqdsk',
                ClientId: '3gbfhl35avtb3uop6o5scbd0sd'
            };
            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
            var userData = {
                Username: $("#email").val(),
                Pool: userPool
            };
            var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
            cognitoUser.authenticateUser(authenticationDetails, {
                onSuccess: function (result) {
                    console.log("Success!");
                    var accessToken = result.getAccessToken().getJwtToken();
                    console.log("Access Token:", accessToken);
                    /* Use the idToken for Logins Map when Federating User Pools with identity pools or when passing through an Authorization Header to an API Gateway Authorizer*/
                    var idToken = result.idToken.jwtToken;
                    console.log("Id Token:", idToken);
                    var decodedIdToken = parseJwt(accessToken);
                    console.log("Decoded Id Token:", decodedIdToken);
                    if ($("#rememberMe").prop("checked")) {
                        // Remember device
                        cognitoUser.setDeviceStatusRemembered({
                            onSuccess: function (result) {
                                console.log('call result: ' + result);
                            },
                            onFailure: function (err) {
                                console.error(err);
                                //TODO Always returns "Network Error"??
                                //alert(err.message);
                            }
                        });
                    } else {
                        // Do not remember device
                        cognitoUser.setDeviceStatusNotRemembered({
                            onSuccess: function (result) {
                                console.log('call result: ' + result);
                            },
                            onFailure: function (err) {
                                console.error(err);
                                //alert(err.message);
                            }
                        });
                    }
                    $(location).attr("href", "index.html");
                },
                onFailure: function (err) {
                    console.log(err);
                    showError(err.message);
                },

            });

            // $.ajax({
            //     method: "POST",
            //     url: `${apiBasePath}/oauth/login`,
            //     contentType: "application/json",
            //     dataType: "json",
            //     cache: false,
            //     data: JSON.stringify({
            //         email: $("#login-form #email").val(),
            //         password: $("#password").val()
            //     })
            // })
            //     .done((data, textStatus, jqXHR) => {
            //         console.log("Text Status:", textStatus);
            //         console.log("Data:", data);
            //         console.log("jqXHR:", jqXHR);
            //         console.log("Token:", data.token);
            //         $("#token").text(`Token: ${data.token}`);
            //         localStorage.setItem("token", data.token);
            //         console.log("Decoded:", parseJwt(data.token));
            //         $(location).attr("href", "index.html");
            //     })
            //     .fail((jqXHR, textStatus, errorThrown) => {
            //         console.error("jqXHR:", jqXHR);
            //         console.error("Text Status:", textStatus);
            //         console.error("Error Thrown:", errorThrown);
            //     });
        });

        function showError(message) {
            $("#error").html(message);
            $("#error").show();
        }
        function clearError() {
            $("#error").hide();
        }

        $("#recoverPassword").on("click", (event) => {
            event.preventDefault();

            if (!$("#login-form #email").val()) {
                alert("Please enter your email before trying to recover your password");
                return;
            }

            var poolData = {
                UserPoolId: 'eu-central-1_7iruUqdsk',
                ClientId: '3gbfhl35avtb3uop6o5scbd0sd'
            };

            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
            var userData = {
                Username: $("#login-form #email").val(),
                Pool: userPool
            };
            var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

            cognitoUser.forgotPassword({
                onSuccess: function (result) {
                    console.log('call result: ' + result);
                    alert("Thank you. Your new password has been set");
                },
                onFailure: function (err) {
                    console.error(err);
                    alert(err);
                },
                inputVerificationCode() {
                    var verificationCode = prompt('Please input verification code ', '');
                    var newPassword = prompt('Enter new password ', '');
                    cognitoUser.confirmPassword(verificationCode, newPassword, this);
                }
            });
        });

            function parseJwt(token) {
                var base64Url = token.split(".")[1]
                var base64 = decodeURIComponent(
                    atob(base64Url)
                        .split("")
                        .map(function(c) {
                            return (
                                "%" +
                                ("00" + c.charCodeAt(0).toString(16)).slice(-2)
                            )
                        })
                        .join("")
                )
                return JSON.parse(base64)
            }

        //#endregion

        //#region register

        $("#resendCode").click(() => {
            cognitoUser.resendConfirmationCode(function (err, result) {
                if (err) {
                    alert("Failed to resend confirmation code");
                    return;
                }
                alert("A new code was sent to you");
            });
        })

        $("#register-form").submit(event => {
            event.preventDefault();
            clearError();

            var poolData = {
                UserPoolId: 'eu-central-1_7iruUqdsk',
                ClientId: '3gbfhl35avtb3uop6o5scbd0sd'
            };
            var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

            var attributeList = [];

            var dataFirstName = {
                Name: 'given_name',
                Value: $("#firstName").val()
            };
            var dataLastName = {
                Name: 'family_name',
                Value: $("#lastName").val()
            };
            // var dataEmail = {
            //     Name: 'email',
            //     Value: $("#register-form #email").val()
            // };
            var attributeFirstName = new AmazonCognitoIdentity.CognitoUserAttribute(dataFirstName);
            var attributeLastName = new AmazonCognitoIdentity.CognitoUserAttribute(dataLastName);
            // var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);

            attributeList.push(attributeFirstName);
            attributeList.push(attributeLastName);
            // attributeList.push(attributeEmail);

            userPool.signUp($("#register-form #email").val(), $("#register-form #password").val(), attributeList, null, function (err, result) {
                if (err) {
                    showError(err);
                    return;
                }
                cognitoUser = result.user;
                console.log('user name is ' + cognitoUser.getUsername());
                // Show confirmation modal dialog
                $("#confirmationModal #code").empty();
                $('#confirmationModal').modal('show');
            });
        });

        $('#confirmationModal').on('shown.bs.modal', function () {
            $('#code').trigger('focus')
        })

        $("#confirmationForm").submit(event => {
            event.preventDefault();
            confirmRegistration($("#code").val());
        });

        function confirmRegistration(code) {
            cognitoUser.confirmRegistration(code, true, function (err, result) {
                if (err) {
                    alert(err.message);
                    return;
                }
                if (result === "SUCCESS") {
                    $(location).attr("href", "login.html");
                }
            });
        }

        $("#accept").change(() => {
            $("#signUp").prop("disabled", !$("#accept").is(":checked"))
        });

        //#endregion

    </script>
    <!--Scripts ends-->
</body>

            $("#register-form #email").on("keyup", () => {
                checkSignUp()
            })

            $("#register-form #password").on("keyup", () => {
                checkSignUp()
            })

            $("#register-form #confirm-password").on("keyup", () => {
                checkSignUp()
            })

            $("#register-form #accept").change(() => {
                checkSignUp()
            })

            function checkSignUp() {
                readyToSignUp =
                    $("#register-form #email").val().length > 0 &&
                    $("#register-form #password").val().length > 0 &&
                    $("#register-form #confirm-password").val().length > 0 &&
                    $("#register-form #password").val() ==
                        $("#register-form #confirm-password").val() &&
                    $("#register-form #accept").prop("checked") == true
                $("#register-form #register-submit").prop(
                    "disabled",
                    !readyToSignUp
                )
            }

            // Register form submit
            $("#register-form").submit(event => {
                event.preventDefault()
                $("#alert-register-error").hide()
                $.ajax({
                    method: "POST",
                    url: `${apiBasePath}/oauth/register`,
                    contentType: "application/json",
                    dataType: "json",
                    cache: false,
                    data: JSON.stringify({
                        email: $("#register-form #email").val(),
                        password: $("#register-form #password").val(),
                    }),
                })
                    .done(async(data, textStatus, jqXHR) => {
                        console.log("Text Status:", textStatus)
                        console.log("Data:", data)
                        console.log("jqXHR:", jqXHR)
                        if (jqXHR.status == 201) {
                            $(location).attr("href", "registration-confirmation.html");
                        }
                    })
                    .fail((jqXHR, textStatus, errorThrown) => {
                        console.error("jqXHR:", jqXHR)
                        console.error("Text Status:", textStatus)
                        console.error("Error Thrown:", errorThrown)
                        $("#alert-register-message").text(
                            jqXHR.responseJSON.message
                        )
                        $("#alert-register-error").show()
                    })
            })
        </script>
        <!--Scripts ends-->
    </body>
</html>
