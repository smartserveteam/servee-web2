<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>
    <!-- Metas -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="LionCoders" />
    <!-- Links -->
    <link rel="icon" type="image/png" href="#" />
    <!-- google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800" rel="stylesheet">
    <!-- Plugins CSS -->
    <link href="css/plugin.css" rel="stylesheet" />
    <!-- style CSS -->
    <link href="css/style.css" rel="stylesheet" />
    <!--color switcher css-->
    <link rel="stylesheet" href="css/switcher/skin-aqua.css" media="screen" id="style-colors" />
    <!-- Date Time Picker -->
    <link rel="stylesheet" href="css/jquery.datetimepicker.min.css">
    <!-- Rate It -->
    <link rel="stylesheet" href="js/rateit/rateit.css">
    <!-- Document Title -->
    <title>Servee.io</title>
</head>

<body>
    <!--Page Wrapper starts-->
    <div class="page-wrapper fixed-footer">
        <!--header starts-->
        <header class="transparent scroll-hide">
            <!--Main Menu starts-->
            <div class="site-navbar-wrap v1">
                <div class="container">
                    <div class="site-navbar">
                        <div class="row align-items-center">
                            <div class="col-md-4 col-6">
                                <a class="navbar-brand" href="index.html"><img src="images/logo-white.png" alt="logo" class="img-fluid"></a>
                            </div>
                            <div class="col-md-8 col-6">
                                <div class="d-lg-none sm-right">
                                    <a href="#" class="mobile-bar js-menu-toggle">
                                        <span class="ion-navicon"></span>
                                    </a>
                                </div>
                                <div id="signin" class="add-list float-right mar-right-5">
                                    <a class="btn btn-info" href="login.html">Sign In</a>
                                </div>
                                <div class="add-list float-right mar-right-5">
                                    <a id="businesses" class="btn btn-outline-info" href="index_pro.html">Businesses</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--mobile-menu starts -->
                    <div class="site-mobile-menu">
                        <div class="site-mobile-menu-header">
                            <div class="site-mobile-menu-close  js-menu-toggle">
                                <span class="ion-ios-close-empty"></span>
                            </div>
                        </div>
                        <div class="site-mobile-menu-body"></div>
                    </div>
                    <!--mobile-menu ends-->
                </div>
            </div>
            <!--Main Menu ends-->
        </header>
        <!--Header ends-->
        <!--Listing Details Hero starts-->
        <div class="listing-details-wrapper bg-h" style="background-image: url(images/single-listing/single-list-1.jpg)">
            <div class="overlay op-3"></div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="list-details-title v1">
                            <div class="row">
                                <div class="col-lg-6 col-md-7 col-sm-12">
                                    <div id="providerHeader" class="single-listing-title float-left">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-5 col-sm-12">
                                    <div class="list-details-btn text-right sm-left">
                                        <div class="save-btn">
                                            <a href="#" class="btn v3 white"><i class="ion-heart"></i> Save</a>
                                        </div>
                                        <div class="share-btn">
                                            <a href="#" class="btn v3 white"><i class="ion-android-share-alt"></i>
                                                Share</a>
                                            <ul class="social-share">
                                                <li class="bg-fb"><a href="#"><i class="ion-social-facebook"></i></a>
                                                </li>
                                                <li class="bg-tt"><a href="#"><i class="ion-social-twitter"></i></a>
                                                </li>
                                                <li class="bg-ig"><a href="#"><i class="ion-social-instagram"></i></a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Listing Details Hero ends-->
        <!--Listing Details Info starts-->
        <div class="list-details-section section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-md-12">
                        <div id="list-menu" class="list_menu">
                            <ul class="list-details-tab fixed_nav">
                                <li class="nav-item active"><a href="#overview" class="active">Overview</a></li>
                                <li class="nav-item"><a href="#gallery">Gallery</a></li>
                                <li class="nav-item"><a href="#costSamples">Cost Samples</a></li>
                                <li class="nav-item"><a href="#reviews">Reviews</a></li>
                                <li class="nav-item"><a href="#add_review">Add Review</a></li>
                            </ul>
                        </div>
                        <!--Listing Details starts-->
                        <div class="list-details-wrap">
                            <div id="overview" class="list-details-section">
                            </div>
                            <div id="gallery" class="list-details-section">
                            </div>
                            <div id="costSamples" class="list-details-section mar-top-75">
                            </div>
                            <div id="reviews" class="list-details-section mar-top-10">
                            </div>
                            <div id="add_review" class="list-details-section mar-top-10">
                                <h4>Add Review</h4>
                                <form id="leave-review" class="contact-form">
                                    <h4 class="contact-form__title">
                                        Rate us and Write a Review
                                    </h4>
                                    <div class="row">
                                        <div class="col-md-6 col-sm-7 col-12">
                                            <span class="contact-form__rate">
                                                Your rating for this listing:
                                                <div class="rateit mb-4" data-rateit-mode="font" id="rateitreview">
                                                </div>
                                            </span>
                                        </div>
                                        <!-- <div class="col-md-6 col-sm-5 col-12">
                                            <div class="contact-form__upload-btn xs-left">
                                                <input disabled class="contact-form__input-file" type="file" name="photo-upload" id="photo-upload">
                                                <span>
                                                    <i class="icofont-upload-alt"></i>
                                                    Upload Photos
                                                </span>
                                            </div>
                                        </div> -->
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <input class="contact-form__input-text" type="text" name="title" id="title" placeholder="Title">
                                        </div>
                                    </div>
                                    <textarea class="contact-form__textarea" name="comment" id="comment" placeholder="Comment"></textarea>
                                    <input class="btn v1" type="submit" name="submit-review" id="submit-review" value="Submit">
                                </form>
                            </div>
                        </div>
                        <!--Listing Details ends-->
                        <!--Similar Listing Starts-->
                        <!-- <div class="similar-listing">
                            <div class="similar-listing-title">
                                <h3>Similar Listings</h3>
                            </div>
                            <div class="swiper-container similar-list-wrap">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide similar-item">
                                        <img src="images/category/places/plumber.jpg" alt="...">
                                        <div class="similar-title-box">
                                            <h5><a href="#">Plumber Warsaw Ochota</a></h5>
                                            <p><span class="price-amt">$89</span>/Avg</p>
                                        </div>
                                        <div class="customer-review">
                                            <div class="rating-summary">
                                                <div class="rating-result" title="60%">
                                                    <ul class="product-rating">
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p><i class="ion-ios-location"></i> 2721 Andy Street, Warsaw, Poland</p>
                                        </div>
                                    </div>
                                    <div class="swiper-slide similar-item">
                                        <img src="images/category/places/place-11.jpg" class="img-fluid" alt="...">
                                        <div class="similar-title-box">
                                            <h5><a href="#">HPogotowie Hydrauliczne</a></h5>
                                            <p><span class="price-amt">$109</span>/Avg</p>
                                        </div>
                                        <div class="customer-review">
                                            <div class="rating-summary">
                                                <div class="rating-result" title="60%">
                                                    <ul class="product-rating">
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p><i class="ion-ios-location"></i> 1301 Avenue Brooklyn, Warsaw, Poland</p>
                                        </div>
                                    </div>
                                    <div class="swiper-slide similar-item">
                                        <img src="images/category/places/place-4.jpg" class="img-fluid" alt="...">
                                        <div class="similar-title-box">
                                            <h5><a href="#">Pomoc Hydrauliczna</a></h5>
                                            <p><span class="price-amt">$75</span>/Avg</p>
                                        </div>
                                        <div class="customer-review">
                                            <div class="rating-summary">
                                                <div class="rating-result" title="60%">
                                                    <ul class="product-rating">
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p><i class="ion-ios-location"></i> 75 Prince St, Warsaw, Poland</p>
                                        </div>

                                    </div>
                                    <div class="swiper-slide similar-item">
                                        <img src="images/category/places/place-9.jpg" class="img-fluid" alt="...">
                                        <div class="similar-title-box">
                                            <h5><a href="#">Hydraulik Warzsawa Wola</a></h5>
                                            <p><span class="price-amt">$89</span>/Avg</p>
                                        </div>
                                        <div class="customer-review">
                                            <div class="rating-summary">
                                                <div class="rating-result" title="60%">
                                                    <ul class="product-rating">
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                        <li><i class="ion-android-star-half"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p><i class="ion-ios-location"></i>21st Queens park, Warsaw, Poland</p>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="slider-btn v3 similar-next"><i class="ion-arrow-right-c"></i></div>
                            <div class="slider-btn v3 similar-prev"><i class="ion-arrow-left-c"></i></div>
                        </div> -->
                        <!--Similar Listing ends-->
                    </div>
                    <div class="col-lg-4 col-md-12">
                        <div class="listing-sidebar">
                            <div id="quoteRequest" class="sidebar-widget info">
                                <h3><i class="ion-android-calendar"></i>Get Help</h3>
                                <div class="row">
                                    <div class="col-md-12 mar-bot-15">
                                        <div class="dropdown">
                                            <button class="btn btn-secondary dropdown-toggle" style="width: 100%;" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Select Category
                                            </button>
                                            <div id="categories" style="width: 100%;" class="dropdown-menu text-center" aria-labelledby="dropdownMenuButton">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 mar-bot-15">
                                        <div class="input-group">
                                            <textarea class="form-control" id="description" cols="30" rows="5" placeholder="Description"></textarea>
                                        </div>
                                    </div>
                                    <span class="col-md-12 mar-bot-15">When?</span>
                                    <div class="col-md-12 mar-bot-15">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text"><i class="icofont-ui-calendar"></i></div>
                                            </div>
                                            <input id="datetimepicker" class="form-control" type="text" placeholder="Preferred Timings">
                                        </div>
                                        <!-- <div id="datepicker-from" class="input-group date" data-date-format="dd-mm-yyyy">
                                            <input class="form-control" type="text" placeholder="Preferred Timings">
                                            <span class="input-group-addon"><i class="icofont-ui-calendar"></i></span>
                                        </div> -->
                                    </div>
                                    <!-- <div class="col-md-6 mar-bot-15">
                                        <div class="book-amount">
                                            <label>Adult</label>
                                            <div class="input-group">
                                                <span class="input-group-btn">
                                                    <button type="button" class="quantity-left-minus btn">
                                                        <span class="ion-minus"></span>
                                                    </button>
                                                </span>
                                                <input type="text" class="form-control input-number" value="1">
                                                <span class="input-group-btn">
                                                    <button type="button" class="quantity-right-plus btn">
                                                        <span class="ion-plus"></span>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mar-bot-15">
                                        <div class="book-amount">
                                            <label>Children</label>
                                            <div class="input-group">
                                                <span class="input-group-btn">
                                                    <button type="button" class="quantity-left-minus btn">
                                                        <span class="ion-minus"></span>
                                                    </button>
                                                </span>
                                                <input type="text" class="form-control input-number" value="1">
                                                <span class="input-group-btn">
                                                    <button type="button" class="quantity-right-plus btn">
                                                        <span class="ion-plus"></span>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div> -->
                                </div>
                                <div class="book-btn text-center">
                                    <a href="booking.html"> Request a Quote</a>
                                </div>
                            </div>
                            <div class="sidebar-widget">
                                <div id="map"></div>
                                <div class="address">
                                    <span class="ion-ios-location"></span>
                                    <p id="address"></p>
                                </div>
                                <div class="address">
                                    <span class="ion-ios-telephone"></span>
                                    <p id="phone"></p>
                                </div>
                                <div class="address">
                                    <span class="ion-android-globe"></span>
                                    <p id="website"></p>
                                </div>
                            </div>
                            <div class="sidebar-widget">
                                <div id="schedule" class="business-time">
                                </div>
                            </div>
                            <!-- <div class="sidebar-widget">
                                <div class="coupon-widget"
                                    style="background-image: url(images/category/coupon/coupon-bg-1.jpg);">
                                    <div class="overlay op-5"></div>
                                    <a href="#" class="coupon-top">
                                        <span class="coupon-link-icon"></span>
                                        <h3>Book Now &amp; get 20% discount</h3>
                                        <div class="daily-deals-wrap v1">
                                            <div class="countdown-deals text-center" data-countdown="2019/12/01"></div>
                                        </div>
                                    </a>
                                    <div class="coupon-bottom">
                                        <p>Coupon Code</p>
                                        <div class="coupon-code">DL76T</div>
                                    </div>
                                </div>
                            </div>
                            <div class="sidebar-widget follow">
                                <div class="follow-img">
                                    <img src="images/clients/reviewer-1.png" class="img-fluid" alt="#">
                                    <h6>Christine Evans</h6>
                                    <span>New York</span>
                                </div>
                                <ul class="social-counts">
                                    <li>
                                        <h6>26</h6>
                                        <span>Listings</span>
                                    </li>
                                    <li>
                                        <h6>326</h6>
                                        <span>Followers</span>
                                    </li>
                                    <li>
                                        <h6>12</h6>
                                        <span>Following</span>
                                    </li>
                                </ul>
                                <div class="text-center mar-bot-25">
                                    <a href="#" class="btn v3"><i class="icofont-eye-alt"></i> Follow</a>
                                </div>
                            </div>
                            <div class="sidebar-widget listing-tags">
                                <h4>Tags</h4>
                                <ul class="list-tags">
                                    <li><a href="#" class="btn v6 dark">Restaurant</a></li>
                                    <li><a href="#" class="btn v6 dark">Hotel</a></li>
                                    <li><a href="#" class="btn v6 dark">Travel</a></li>
                                    <li><a href="#" class="btn v6 dark">Food</a></li>
                                    <li><a href="#" class="btn v6 dark">Living</a></li>
                                    <li><a href="#" class="btn v6 dark">Luxury</a></li>
                                    <li><a href="#" class="btn v6 dark">Eat &amp; Drink</a></li>
                                </ul>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Listing Details Info ends-->
        <!-- Scroll to top starts-->
        <span class="scrolltotop"><i class="ion-arrow-up-c"></i></span>
        <!-- Scroll to top ends-->
    </div>
    <!--Page Wrapper ends-->
    <!--Footer Starts-->
    <div class="footer-wrapper no-pad-tb footer-fixed">
        <div class="footer-top-area section-padding" style="background-image: url(images/bg/pattern.png)">
            <div class="overlay op-9 green"></div>
            <div class="container">
                <div class="row nav-folderized">
                    <div class="col-lg-3 col-md-12">
                        <div class="footer-logo">
                            <a href="index.html"> <img src="images/logo-white.png" alt="logo"></a>
                            <div class="company-desc">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio excepturi nam
                                    totam sequi, ipsam consequatur repudiandae libero illum.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-12">
                        <div class="footer-content nav">
                            <h2 class="title">Helpful Links</h2>
                            <ul class="list">
                                <li><a class="link-hov style1" href="#">Login</a></li>
                                <li><a class="link-hov style1" href="#">My Account</a></li>
                                <li><a class="link-hov style1" href="#">Add Listing</a></li>
                                <li><a class="link-hov style1" href="#">Privacy policy</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-12">
                        <div class="footer-content nav">
                            <h2 class="title">Category</h2>
                            <ul class="list">
                                <li><a class="link-hov style1" href="#">Shop</a></li>
                                <li><a class="link-hov style1" href="#">Travel</a></li>
                                <li><a class="link-hov style1" href="#">Sport</a></li>
                                <li><a class="link-hov style1" href="#">Restaurant</a></li>

                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-12">
                        <div class="footer-content nav">
                            <h2 class="title">Contact us</h2>
                            <ul class="list footer-list">
                                <li>
                                    <div class="contact-info">
                                        <div class="icon">
                                            <i class="ion-ios-location"></i>
                                        </div>
                                        <div class="text">13th North Ave, Florida, USA</div>
                                    </div>
                                </li>
                                <li>
                                    <div class="contact-info">
                                        <div class="icon">
                                            <i class="ion-email"></i>
                                        </div>
                                        <div class="text"><a href="#">info@listagram.com</a></div>
                                    </div>
                                </li>
                                <li>
                                    <div class="contact-info">
                                        <div class="icon">
                                            <i class="ion-ios-telephone"></i>
                                        </div>
                                        <div class="text">+44 078 767 595</div>
                                    </div>
                                </li>
                            </ul>
                            <ul class="social-buttons style2">
                                <li><a href="#"><i class="ion-social-facebook"></i></a></li>
                                <li><a href="#"><i class="ion-social-twitter"></i></a></li>
                                <li><a href="#"><i class="ion-social-pinterest"></i></a></li>
                                <li><a href="#"><i class="ion-social-youtube"></i></a></li>
                                <li><a href="#"><i class="ion-social-dribbble"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom-area">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 offset-md-2 text-center">
                        <p>&copy; 2019 listagram. All Rights Reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Footer ends-->
    <!--Scripts starts-->
    <!--plugin js-->
    <script src="js/plugin.js"></script>
    <!--google maps-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVvsK4COEruAO5KSmhzGdmTpqzz2jfnNk&amp;libraries=places"></script>
    <!--moment.js-->
    <script src="https://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <!--Date Time Picker-->
    <script src="js/jquery.datetimepicker.full.min.js"></script>
    <!--Cookies-->
    <script src="js/js.cookie.js"></script>
    <!--RateIt-->
    <script src="js/rateit/jquery.rateit.min.js"></script>
    <!--Main js-->
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>

        var providerId = getUrlParameter("providerId");

        $("#leave-review #submit-review").on("click", async (e) => {
            e.preventDefault();

            //Submit review
            getLoggedInUserId().then((user) => {
                createReview(user.id, providerId, $("#leave-review #title").val(), $("#leave-review #comment").val(), $("#rateitreview").rateit("value")).then((response) => {
                }).catch((error) => {
                    console.error("Failed to get user by cognito id:", error);
                    alert("Failed to get user by cognito id:" + error.statusText);
                })

            }).catch((error) => {
                console.error("Failed to submit review:", error);
                alert("Failed to submit review:" + error.statusText);
            });
        });

        $('#datetimepicker').datetimepicker({
            timepicker: true,
            formatDate: 'Y/m/d',
            minDate: '0',
            onChangeDateTime: logic,
            onShow: logic
        });

        // Business Hours
        var openHours = [];

        main();

        async function main() {

            if (!providerId) {
                window.history.back();
                return;
            }

            var isUserLoggedIn = await isLoggedIn();
            if (!isUserLoggedIn) {
                $("#booking").addClass("disableddiv");
                $("#add_review").addClass("disableddiv");
            }

            // Get provider details
            console.log("Getting provider:" + providerId);
            getUser(providerId).then((provider) => {
                // Populate fields
                populateProviderInfo(provider);
            }).catch((error) => {
                console.error("Failed to retrieve provider:", error);
                alert("Failed to retrieve provider:" + error.statusText);
            })
        }

        async function populateProviderInfo(provider) {
            // Categories
            for (let index = 0; index < provider.categoriesProvided.length; index++) {
                const categoryId = provider.categoriesProvided[index];

                // Add tags
                var category = await getCategoryDetails(categoryId);
                console.log("Category Name:", category.name);
                var headerParagraph = $("<p/>", {}).appendTo("#providerHeader");
                var categoryLink = $("<a/>", { class: "btn v6", href: `categories.html?categoryId=${categoryId}` }).text(category.name).appendTo(headerParagraph);

                // Add category to quote widget
                //<a class="dropdown-item" href="#">Action</a>
                $("<a/>", { class: "dropdown-item", href: "#", style: "width: 100%;" }).text(category.name).appendTo("#categories");

            }

            // Business Name
            var businessNameH2 = $("<h2/>", {}).text(`${provider.businessName} `).appendTo("#providerHeader");
            if (provider.isVerified) {
                $("<i/>", { class: "icofont-tick-boxed" }).appendTo(businessNameH2);
            }

            // Address
            var addressParagraph = $("<p/>", {}).appendTo("#providerHeader");
            addressParagraph.html(`<i class="ion-ios-location"></i> ${provider.address}, ${provider.postalCode} ${provider.city}`);

            // Score
            var scoreSpan = $("<span/>", { class: "list-ratings" }).appendTo("#providerHeader");
            provider.score = 4; //TODO: For testing purposes
            //TODO: Add code to handle half stars
            for (let index = 0; index < provider.score; index++) {
                $("<span/>", { class: "ion-android-star" }).appendTo(scoreSpan);
            }
            if (provider.score < 5) {
                for (let index = 0; index < 5 - provider.score; index++) {
                    $("<span/>", { class: "ion-android-star-outline" }).appendTo(scoreSpan);
                }
            }
            $("<a/>", { href: "#" }).text(`(3 Reviews)`).appendTo(scoreSpan); //TODO: Get number of reviews

            // Overview
            $("<h4/>", {}).text("Overview").appendTo("#overview");
            var contentDiv = $("<div/>", { class: "overview-content" }).appendTo("#overview");
            $("<p/>", { class: "mar-bot-10" }).text(provider.description).appendTo(contentDiv);
            var servicesProvidedDiv = $("<div/>", { class: "mar-top-20" }).appendTo("#overview");
            $("<h6/>", {}).text("Services Provided").appendTo(servicesProvidedDiv);
            var servicesProvidedList = $("<ul/>", { class: "listing-features" }).appendTo(servicesProvidedDiv);
            for (let index = 0; index < provider.categoriesProvided.length; index++) {
                const serviceProvidedId = provider.categoriesProvided[index];
                var serviceProvided = await getCategoryDetails(serviceProvidedId);
                let li = $("<li/>", {}).appendTo(servicesProvidedList);
                li.html(`<i class="${serviceProvided.icon}"></i> ${serviceProvided.name}`);
            }

            // Gallery
            $("<h4/>", {}).text("Gallery").appendTo("#gallery");
            // Carousel Wrapper
            var carousel = $("<div/>", { class: "carousel slide carousel-fade carousel-thumbnails list-gallery", id: "carousel-thumb", "provider-ride": "carousel" }).appendTo("#gallery");
            // Slides
            var carouselInnerDiv = $("<div/>", { class: "carousel-inner", role: "listbox" }).appendTo(carousel);

            //TODO: For testing only
            if (!provider.workPhotoAlbums) {
                provider.workPhotoAlbums = [];
                provider.workPhotoAlbums.push("images/single-listing/gallery-1.jpg");
                provider.workPhotoAlbums.push("images/single-listing/gallery-2.jpg");
            }
            for (let index = 0; index < provider.workPhotoAlbums.length; index++) {
                const photo = provider.workPhotoAlbums[index];
                console.log("Photo:", photo);
                let carouselItem = $("<div/>", { class: `carousel-item ${index == 0 ? "active" : ""}` }).appendTo(carouselInnerDiv);
                $("<img/>", { class: "d-block w-100", src: photo, alt: "slide" }).appendTo(carouselItem);
            }

            // Controls
            var controlPrev = $("<a/>", { class: "carousel-control-prev", href: "#carousel-thumb", role: "button", "provider-slide": "prev" }).appendTo(carousel);
            $("<span/>", { class: "ion-arrow-left-c", "aria-hidden": "true" }).appendTo(controlPrev);
            $("<span/>", { class: "sr-only" }).text("Previous").appendTo(controlPrev);
            var controlNext = $("<a/>", { class: "carousel-control-next", href: "#carousel-thumb", role: "button", "provider-slide": "next" }).appendTo(carousel);
            $("<span/>", { class: "ion-arrow-right-c", "aria-hidden": "true" }).appendTo(controlNext);
            $("<span/>", { class: "sr-only" }).text("Next").appendTo(controlNext);

            // Thumbnails
            var ol = $("<ol/>", { class: "carousel-indicators list-gallery-thumb" }).appendTo(carousel);
            for (let index = 0; index < provider.workPhotoAlbums.length; index++) {
                const photo = provider.workPhotoAlbums[index];
                let li = $("<li/>", { "provider-target": "#carousel-thumb", "provider-slide-to": index }).appendTo(ol);
                $("<img/>", { class: "img-fluid d-block w-100", src: photo, alt: "..." }).appendTo(li);
            }

            // Schedule
            var businessTitleDiv = $("<div/>", { class: "business-title" }).appendTo("#schedule");
            var h6 = $("<h6/>", {}).appendTo(businessTitleDiv);
            h6.html('<i class="ion-android-alarm-clock"></i> Business Hours');
            $("<span/>", { class: "float-right" }).text("Open Now").appendTo(businessTitleDiv); //TODO: Calculate if open now

            if (provider.schedule) {
                var disabledWeekDays = [];
                console.log("Got provider schedules:", provider.schedule);
                var scheduleList = $("<ul/>", { class: "business-hours" }).appendTo("#schedule");
                for (let index = 0; index < provider.schedule.length; index++) {
                    const schedule = provider.schedule[index];
                    var businessOpenList, openCloseIntervalsDiv;
                    if (schedule.intervals.length == 0) {
                        // Closed
                        businessOpenList = $("<li/>", { class: `business-open trend-closed` }).appendTo(scheduleList);
                        $("<span/>", { class: "day" }).text(dayOfWeekAsString(schedule.day)).appendTo(businessOpenList);
                        openCloseIntervalsDiv = $("<div/>", { class: "atbd_open_close_time" }).appendTo(businessOpenList);
                        $("<span/>", { class: "time" }).text("Closed").appendTo(openCloseIntervalsDiv);
                        disabledWeekDays.push(schedule.day);
                    } else {
                        // Open hours
                        businessOpenList = $("<li/>", { class: `business-open` }).appendTo(scheduleList);
                        $("<span/>", { class: "day" }).text(dayOfWeekAsString(schedule.day)).appendTo(businessOpenList);
                        openCloseIntervalsDiv = $("<div/>", { class: "atbd_open_close_time" }).appendTo(businessOpenList);
                        for (let intervalIndex = 0; intervalIndex < schedule.intervals.length; intervalIndex++) {
                            const interval = schedule.intervals[intervalIndex];
                            var startTime = $("<span/>", { class: "time" }).html(`${interval.startTime} - ${interval.endTime}<br/>`).appendTo(openCloseIntervalsDiv);
                            if (openHours[schedule.day]) {
                                // Add allowTimes
                                console.log(`Add startTime to day ${schedule.day} (${openHours[schedule.day].allowTimes})`);
                                pushTimeRange(schedule.day, interval.startTime, interval.endTime);
                            } else {
                                console.log("Add NEW intervals to", openHours);
                                pushTimeRange(schedule.day, interval.startTime, interval.endTime);
                            }
                        }
                    }
                }
                console.log("disabledWeekDays:", disabledWeekDays);
                $("#datetimepicker").datetimepicker('setOptions', { disabledWeekDays: disabledWeekDays });
            }

            // Map
            $("#address").text(`${provider.address}, ${provider.postalCode} ${provider.city}`);
            $("#phone").text(provider.phone);
            $("#website").text(provider.website);

            doGeocode(provider.address, provider.postalCode, provider.country, (results) => {
                console.log("Results:", results);
                // Only use the first result
                let lat = results[0].geometry.location.lat();
                let long = results[0].geometry.location.lng();

                var mapOptions = {
                    // How zoomed in you want the map to start at (always required)
                    zoom: 15,
                    // The latitude and longitude to center the map (always required)
                    center: new google.maps.LatLng(lat, long),
                    scrollwheel: false,
                    // How you would like to style the map.
                    // This is where you would paste any style found on Snazzy Maps.
                    styles: [
                        {
                            "featureType": "administrative",
                            "elementType": "geometry",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "administrative.land_parcel",
                            "elementType": "labels",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "poi",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "road",
                            "elementType": "labels.icon",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "road.local",
                            "elementType": "labels",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        },
                        {
                            "featureType": "transit",
                            "stylers": [
                                {
                                    "visibility": "off"
                                }
                            ]
                        }
                    ]
                };

                var mapElement = document.getElementById('map');
                var map = new google.maps.Map(mapElement, mapOptions);

                var image = 'images/others/marker.png';
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, long),
                    map: map,
                    icon: image,
                    draggable: true,
                    animation: google.maps.Animation.DROP
                });
                marker.addListener('click', toggleBounce);
            });

            // Cost Samples
            if (provider.costSamples) {
                var costSampleTitle = $("<h4/>").text("Cost Samples").appendTo("#costSamples");
                var costSampleWrapper = $("<div/>", { class: "room-type-wrapper" }).appendTo("#costSamples");
                for (let costSampleIndex = 0; costSampleIndex < provider.costSamples.length; costSampleIndex++) {
                    const costSample = provider.costSamples[costSampleIndex];
                    var costSampleItem = $("<div/>", { class: "room-type-item" }).appendTo(costSampleWrapper);
                    var costSampleRow = $("<div/>", { class: "row" }).appendTo(costSampleItem);

                    // Image
                    var costSampleColImg = $("<div/>", { class: "col-md-4" }).appendTo(costSampleRow);
                    var costSampleLink = $("<a/>", { href: costSample.picture, "provider-lightbox": "single-1" }).appendTo(costSampleColImg);
                    $("<img/>", { src: costSample.picture, alt: "..." }).appendTo(costSampleLink);

                    // Content
                    var costSampleColContent = $("<div/>", { class: "col-md-8" }).appendTo(costSampleRow);
                    var costSampleColContentRow = $("<div/>", { class: "row" }).appendTo(costSampleColContent);

                    // Type and Max
                    var costSampleColContentSub = $("<div/>", { class: "col-md-6" }).appendTo(costSampleColContentRow);
                    var costSampleColContentFeatureLeft = $("<div/>", { class: "feature-left float-left" }).appendTo(costSampleColContentSub);
                    $("<h3/>", {}).text(costSample.type).appendTo(costSampleColContentFeatureLeft);
                    if (costSample.max) {
                        var maxParagraph = $("<p/>", {}).text("Max : ").appendTo(costSampleColContentFeatureLeft);
                        $("<span/>", {}).text(costSample.max).appendTo(maxParagraph);
                    }

                    // Icons
                    var costSampleFacilitiesList = $("<div/>", { class: "facilities-list" }).appendTo(costSampleColContentFeatureLeft);
                    var facilitiesList = $("<ul/>", {}).appendTo(costSampleFacilitiesList);
                    for (let iconIndex = 0; iconIndex < costSample.icons.length; iconIndex++) {
                        const icon = costSample.icons[iconIndex];
                        var li = $("<li/>", {}).appendTo(facilitiesList);
                        $("<i/>", { class: icon }).appendTo(li);
                    }

                    // Price and Description
                    var costSampleColContentSub2 = $("<div/>", { class: "col-md-6" }).appendTo(costSampleColContentRow);
                    var costSampleColContentFeatureRight = $("<div/>", { class: "feature-right float-right" }).appendTo(costSampleColContentSub2);
                    $("<span/>", { class: "price-amt" }).text(`${costSample.price} ${costSample.currency}`).appendTo(costSampleColContentFeatureRight);
                    costSampleColContentFeatureRight.append(costSample.description);
                    $("<div/>", { class: "clear" }).appendTo(costSampleColContentFeatureRight);
                }
            }

            // Reviews
            getReviews(provider.id).then(async (reviews) => {
                var reviewsTitle = $("<h4/>", {}).text("Reviews").appendTo("#reviews");
                $("<span/>", {}).text(` (${reviews.length})`).appendTo(reviewsTitle);
                var reviewBox = $("<div/>", { class: "review-box" }).appendTo("#reviews");
                var reviewWrapList = $("<ul/>", { class: "review_wrap" }).appendTo(reviewBox);
                for (let reviewIndex = 0; reviewIndex < reviews.length; reviewIndex++) {
                    const review = reviews[reviewIndex];

                    // Get reviewer username
                    var userInfo = parseJwt(getIdToken().jwtToken);

                    var reviewLi = $("<li/>", {}).appendTo(reviewWrapList);
                    var customerReviewWrap = $("<div/>", { class: "customer-review_wrap" }).appendTo(reviewLi);
                    // Reviewer
                    var reviewerImg = $("<div/>", { class: "reviewer-img" }).appendTo(customerReviewWrap);
                    $("<img/>", { src: "images/clients/reviewer-1.png", class: "img-fluid", alt: "..." }).appendTo(reviewerImg); //TODO: Add user image
                    reviewerImg.append(`<figcaption style="text-align:center">${userInfo.given_name} ${userInfo.family_name}</figcaption>`);
                    $("<figcaption/>", { style: "text-align:center" }).text(`35 Reviews`).appendTo(reviewerImg); //TODO: Add number of reviews provided by user
                    var customerContentWrap = $("<div/>", { class: "customer-content-wrap" }).appendTo(customerReviewWrap);
                    var customerContent = $("<div/>", { class: "customer-content" }).appendTo(customerContentWrap);
                    var customerReview = $("<div/>", { class: "customer-review" }).appendTo(customerContent);
                    // Review title
                    $("<h6/>", {}).text(review.title || "").appendTo(customerReview);
                    $("<p/>", {}).text(`Posted ${moment(review.updatedAt).fromNow()}`).appendTo(customerReview);
                    // Review comment
                    $("<div/>", { class: "customer-rating" }).text(review.score).appendTo(customerContent);
                    $("<p/>", { class: "customer-text" }).text(review.comment).appendTo(customerContentWrap);
                    // Review pics
                    if (review.pictures) {
                        for (let reviewPictureIndex = 0; reviewPictureIndex < review.pictures.length; reviewPictureIndex++) {
                            const reviewPicture = review.pictures[reviewPictureIndex];
                            $("<img/>", { src: reviewPicture, alt: "..." });
                        }
                    }
                    // Like button
                    var likeDiv = $("<div/>", { class: "like-btn mar-top-40" }).appendTo(customerContentWrap);
                    var likeLink = $("<a/>", { href: "#", class: "rate-review float-left" }).appendTo(likeDiv);
                    $("<i/>", { class: "icofont-thumbs-up" }).appendTo(likeLink);
                    likeLink.append("Helpful Review");
                    $("<span/>", {}).text(review.likes).appendTo(likeLink);
                    var replyLink = $("<a/>", { href: "#", class: "rate-review float-right" }).appendTo(likeDiv);
                    $("<i/>", { class: "icofont-reply" }).appendTo(replyLink);
                    replyLink.append("Reply");

                    // Replies
                    if (review.replies) {
                        for (let reviewRepliesIndex = 0; reviewRepliesIndex < review.replies.length; reviewRepliesIndex++) {
                            const reply = review.replies[reviewRepliesIndex];

                            let reviewReply = $("<ul/>", { class: "has-child" }).appendTo(reviewLi);
                            let replyLi = $("<li/>", {}).appendTo(reviewReply);
                            let replyCustomerReviewWrap = $("<div/>", { class: "customer-review_wrap" }).appendTo(replyLi);
                            // Reviewer
                            let replyReviewerImg = $("<div/>", { class: "reviewer-img" }).appendTo(customerReviewWrap);
                            $("<img/>", { src: "images/clients/reviewer-1.png", class: "img-fluid", alt: "..." }).appendTo(replyReviewerImg); //TODO: Add user image
                            replyReviewerImg.append("<p>Username</p>"); //TODO: Add user's name
                            $("<span/>", {}).text(`35 Reviews`).appendTo(replyReviewerImg); //TODO: Add number of reviews provided by user
                            let replyCustomerContentWrap = $("<div/>", { class: "customer-content-wrap" }).appendTo(customerReviewWrap);
                            let replyCustomerContent = $("<div/>", { class: "customer-content" }).appendTo(replyCustomerContentWrap);
                            let replyCustomerReview = $("<div/>", { class: "customer-review" }).appendTo(replyCustomerContent);
                            // Review title
                            $("<h6/>", {}).text(reply.title || "").appendTo(replyCustomerReview);
                            $("<p/>", {}).text(`Posted ${moment(review.updatedAt).fromNow()}`).appendTo(replyCustomerReview);
                            // Review content
                            $("<div/>", { class: "customer-rating" }).text(reply.score).appendTo(replyCustomerContent);
                            $("<p/>", { class: "customer-text" }).text(reply.content).appendTo(replyCustomerContentWrap);
                            // Review pics
                            if (reply.pictures) {
                                for (let reviewPictureIndex = 0; reviewPictureIndex < reply.pictures.length; reviewPictureIndex++) {
                                    const reviewPicture = reply.pictures[reviewPictureIndex];
                                    $("<img/>", { src: reviewPicture, alt: "..." });
                                }
                            }
                            // Like button
                            let replyLikeDiv = $("<div/>", { class: "like-btn mar-top-40" }).appendTo(replyCustomerContentWrap);
                            let replyLikeLink = $("<a/>", { href: "#", class: "rate-review float-left" }).appendTo(replyLikeDiv);
                            $("<i/>", { class: "icofont-thumbs-up" }).appendTo(replyLikeLink);
                            replyLikeLink.append("Helpful Review");
                            $("<span/>", {}).text(reply.likes).appendTo(replyLikeLink);
                            let replyLink = $("<a/>", { href: "#", class: "rate-review float-right" }).appendTo(replyLikeDiv);
                            $("<i/>", { class: "icofont-reply" }).appendTo(replyLink);
                            replyLink.append("Reply");
                        }
                    }
                }
            })
                .catch((error) => {
                    console.error("Failed to retrieve reviews:", error);
                    alert("Failed to retrieve reviews:" + error);
                })
        }


        function pushTimeRange(day, startTime, endTime) {
            var x = 15; //minutes interval
            var times = []; // time array
            var tt = parseInt(startTime.split(":")[0]) * 60; // start time
            var endtt = parseInt(endTime.split(":")[0]) * 60; // end time

            //loop to increment the time and push results in array
            for (var i = 0; tt < endtt; i++) {
                var hh = Math.floor(tt / 60); // getting hours of day in 0-24 format
                var mm = (tt % 60); // getting minutes of the hour in 0-55 format
                times[i] = ("0" + (hh)).slice(-2) + ':' + ("0" + mm).slice(-2); // pushing data in array in [00:00 - 12:00 AM/PM format]
                tt = tt + x;
            }
            for (let index = 0; index < times.length; index++) {
                const time = times[index];
                if (!openHours[day]) {
                    openHours[day] = { allowTimes: [] };
                }
                openHours[day].allowTimes.push(time);
            }
        }

        function logic(currentDateTime) {
            if (!currentDateTime) {
                return;
            }
            var dayEntry = openHours[currentDateTime.getDay()];
            this.setOptions({
                allowTimes: dayEntry.allowTimes
            })
        };

        function doGeocode(address, postal_code, country, callback) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                'address': address,
                'componentRestrictions': {
                    'postalCode': postal_code,
                    'country': country
                }
            }, function (results, status) {
                if (status === google.maps.GeocoderStatus.OK) {
                    callback(results);
                } else {
                    //Error handling
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function toggleBounce() {
            if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        }

        async function getCategoryDetails(categoryId) {
            // Get category name
            return $.ajax({
                method: "GET",
                url: `${categoriesApiBasePath}/categories/${categoryId}`,
                dataType: "json",
                cache: false
            })
                .done((data, textStatus, jqXHR) => {
                    console.log("Text Status:", textStatus);
                    console.log("Data:", data);
                    console.log("jqXHR:", jqXHR);
                    console.log("Returning", data.name);
                    return data.name;
                })
                .fail((jqXHR, textStatus, errorThrown) => {
                    console.error("jqXHR:", jqXHR);
                    console.error("Text Status:", textStatus);
                    console.error("Error Thrown:", errorThrown);
                });

        }

        function dayOfWeekAsString(dayIndex) {
            return ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][dayIndex];
        }

    </script>
    <!--Scripts ends-->
</body>

</html>